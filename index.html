<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link rel='manifest' href='./manifest.json'>
    <meta name="viewport" content="width=device-width">
    <title>ReptiTrack</title>
    <link href="style.css" rel="stylesheet" type="text/css" />
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dexie/2.0.4/dexie.min.js"></script>
    <script src="https://d3js.org/d3.v4.js"></script>

    <style>
        body {
            margin: 0;
        }
        :root {
            --mdc-theme-primary: #498e45;
        }
        .template {
            display:none;
        }
    </style>

</head>

<body>
    <aside class="mdc-drawer mdc-drawer--modal" data-mdc-auto-init="MDCDrawer">
        <div class="mdc-drawer__content">
            <nav class="mdc-list">
                <a class="mdc-list-item mdc-list-item--activated" href="#page1" aria-current="page">
                    <i class="material-icons mdc-list-item__graphic" aria-hidden="true">page1</i>
                    <span class="mdc-list-item__text">Pet Profiles</span>
                </a>
                <a class="mdc-list-item" href="#page2">
                    <i class="material-icons mdc-list-item__graphic" aria-hidden="true">page2</i>
                    <span class="mdc-list-item__text">Activity Tracker</span>
                </a>
                <a class="mdc-list-item" href="#page3">
                    <i class="material-icons mdc-list-item__graphic" aria-hidden="true">page3</i>
                    <span class="mdc-list-item__text">Calendar</span>
                </a>
            </nav>
        </div>
    </aside>

    <div class="mdc-drawer-scrim"></div>

    <header class="mdc-top-app-bar">
        <div class="mdc-top-app-bar__row">
            <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
                <button class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button">menu</button>
                <span class="mdc-top-app-bar__title">ReptiTrack</span>
            </section>
            <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end" role="toolbar">
                <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Download">file_download</button>
                <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Print this page">print</button>
                <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Bookmark this page">bookmark</button>
                <!--                 <button onclick="goBack()">Go Back</button> -->
            </section>
        </div>
    </header>

    <div class="mdc-top-app-bar--fixed-adjust content" id="page1" style="display: none">
        <h1 style="font-weight:bold">Pet Profiles</h1>
        <p style="color:gray">
            <input type="text" id="petName" placeholder="Enter your pet's name">
            <input type="text" id="petAge" placeholder="Enter your pet's age">
            <input type="text" id="petWeight" placeholder="Enter your pet's weight">
            <button id="btnSave">Save</button>
            <button id="btnShow">Show</button>
        </p>

        <div class="mdc-data-table">
            <table class="mdc-data-table__table" aria-label="Dessert calories">
                <thead>
                    <tr class="mdc-data-table__header-row">
                        <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Name</th>
                        <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col">Age (Years)</th>
                        <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col">Weight (Grams)</th>
                        <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Comments</th>
                    </tr>
                </thead>
                <tbody id="petsList" class="mdc-data-table__content">
                </tbody>
            </table>
        </div>

    </div>

    <div class="mdc-top-app-bar--fixed-adjust content" id="page2" style="display: none">
        <h1 style="font-weight:bold">Activity Tracker</h1>
        <p>Enter your pet's name and activity level (0 - 10)</p>
        <p>Note: the entered name will be the pet's activity level displayed</p>
        <p style="color:gray">
            <input type="text" id="petName2" placeholder="Enter your pet's name">
            <input type="text" id="petActivity" placeholder="Enter your pet's activity level">
            <button id="btnSave2">Save</button>
            <button id="btnShow2">Show</button>
        </p>
    </div>
    
    <div class = "content" id="activity_dataviz" style="display: none" ></div>

    <div class="mdc-top-app-bar--fixed-adjust content" id="page3" style="display: none">
        <h1 style="font-weight:bold">Calendar</h1>
        <p style="color:gray">
            Third page p element
        </p>
    </div>

    <script src="script.js"></script>
    
    <script>
// set the dimensions and margins of the graph
var margin = {top: 10, right: 30, bottom: 30, left: 60},
    width = 460 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;
// append the svg object to the body of the page
var svg = d3.select("#activity_dataviz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");
//Read the data
d3.csv("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/connectedscatter.csv",
  // When reading the csv, I must format variables:
  function(d){
    return { date : d3.timeParse("%Y-%m-%d")(d.date), value : d.value }
  },
  // Now I can use this dataset:
  function(data) {
    // Add X axis --> it is a date format
    var x = d3.scaleTime()
      .domain(d3.extent(data, function(d) { return d.date; }))
      .range([ 0, width ]);
    svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));
    // Add Y axis
    var y = d3.scaleLinear()
      .domain( [8000, 9200])
      .range([ height, 0 ]);
    svg.append("g")
      .call(d3.axisLeft(y));
    // Add the line
    svg.append("path")
      .datum(data)
      .attr("fill", "none")
      .attr("stroke", "#69b3a2")
      .attr("stroke-width", 1.5)
      .attr("d", d3.line()
        .x(function(d) { return x(d.date) })
        .y(function(d) { return y(d.value) })
        )
    // Add the points
    svg
      .append("g")
      .selectAll("dot")
      .data(data)
      .enter()
      .append("circle")
        .attr("cx", function(d) { return x(d.date) } )
        .attr("cy", function(d) { return y(d.value) } )
        .attr("r", 5)
        .attr("fill", "#69b3a2")
})
</script>
    
    <script>
        window.mdc.autoInit();
        const drawer = document.querySelector('.mdc-drawer').MDCDrawer;

        function hideScreens() {
            $(".content").hide();
        }
         // open drawer on nav icon
        document.getElementsByClassName("mdc-top-app-bar__navigation-icon")[0].addEventListener("click", function() {
            drawer.open = true;
        });
         // close drawer on selection
        let navs = document.getElementsByClassName("mdc-list-item");
        for(let i = 0; i < navs.length; i++) {
            navs[i].addEventListener("click", function() {
                drawer.open = false;
                hideScreens();
                var target = $(this).attr("href");
                //console.log("drawer" + target)
                $(target).show();
            })
        };
    </script>

    <script>
        const db = new Dexie('MyDatabase');
         // Declare tables, IDs and indexes
        db.version(1).stores({
            pets: '++id, pet_name, pet_age, pet_weight',
            activities: '++id, pet_name, pet_activity',
            history: '++id'
        });
        
        $("#btnSave").on("click", function() {
            var name = $("#petName").val()
            var age = $("#petAge").val()
            var weight = $("#petWeight").val()
            db.pets.add({
                pet_name: name,
                pet_age: age,
                pet_weight: weight
            }).then(function() {
                alert(name + " added!")
            });
        });
        
         //show all pets in the DB
        $("#btnShow").on("click", function() {
            $("#petsList").empty()
            db.pets.each(pet => showPet(pet));
        });
        
//Activity tracker page buttons
        //save the pet's activity level
        $("#btnSave2").on("click", function() {
            var name = $("#petName2").val()
            var activity = $("#petActivity").val()
            db.activities.add({
                pet_name: name,
                pet_activity: activity
            }).then(function() {
                alert(name + " added!")
            });
        });
         //show the specified pet's activity level
        $("#btnShow2").on("click", function() {
//need to figure out how to use d3.js to display this info
            console.log("activity show button clicked");
            hideScreens();
            $("#activity_dataviz").show();
            //db.activities.each();
        });
        
        function showPet(pet) {
            var tr = $("<tr>");
            tr.addClass("mdc-data-table__row");
            var td1 = $("<td>");
            td1.addClass("mdc-data-table__cell");
            td1.text(pet.pet_name);
            tr.append(td1);
            var td2 = $("<td>");
            td2.addClass("mdc-data-table__cell mdc-data-table__cell--numeric");
            td2.text(pet.pet_age);
            tr.append(td2);
            var td3 = $("<td>");
            td3.addClass("mdc-data-table__cell mdc-data-table__cell--numeric");
            td3.text(pet.pet_weight);
            tr.append(td3);
            var td4 = $("<td>");
            td4.addClass("mdc-data-table__cell");
            tr.append(td4);
            $("#petsList").append(tr);
        }
    </script>
    
    <!-- NOT SURE ABOUT HOW TO ACTUALLY ADD THIS, CAN'T FIGURE OUT HOW TO SHOW THE TARGET SCREEN
<script>
function goBack() {
  window.history.back();
    console.log(window.history)
    hideScreens();
    var target = window.location.href.slice(window.location.href.search("#"));
    console.log("goBack " + target)
    $(target).show();
}
</script> -->

    <!--     <script>
        // register the service worker for offline use
        if('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js').then(function() {
                console.log("Service Worker Registered");
            });
        }
    </script>
</body> -->

</html>